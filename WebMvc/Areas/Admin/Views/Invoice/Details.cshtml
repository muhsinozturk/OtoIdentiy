@model Application.DTOs.Invoice.InvoiceDto

<div class="container-fluid px-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Fatura Detayı <small class="text-muted">(#@Model.Id)</small></h2>
        <a asp-action="Index"  class="btn btn-secondary">
            Geri Dön 
        </a>
    </div>

    <!-- Fatura Bilgileri -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white fw-bold">
            Genel Bilgiler
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-4">
                    <strong>Fatura Tarihi:</strong> @Model.Date.ToString("g")
                </div>
                <div class="col-md-4">
                    <strong>İş Emri No:</strong> @Model.WorkOrderId
                </div>
                <div class="col-md-4">
                    <strong>Araç:</strong> @Model.VehiclePlate
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-md-4"><strong>İşçilik:</strong> @Model.LaborCost.ToString("N2") ₺</div>
                <div class="col-md-4"><strong>Ara Toplam:</strong> @Model.SubTotal.ToString("N2") ₺</div>
                <div class="col-md-4"><strong>KDV Toplamı:</strong> @Model.TotalVat.ToString("N2") ₺</div>
            </div>
            <div class="fw-bold text-success fs-5">
                Genel Toplam (KDV + İşçilik Dahil): @Model.Total.ToString("N2") ₺
            </div>
        </div>
    </div>

    <!-- Fatura Kalemleri -->
    <div class="card shadow-sm">
        <div class="card-header bg-info text-white fw-bold">
            Fatura Kalemleri
        </div>
        <div class="card-body table-responsive">
            <table class="table table-bordered table-striped text-center align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Stok Adı</th>
                        <th>Depo</th>
                        <th>Miktar</th>
                        <th>Birim Fiyat</th>
                        <th>Ara Toplam</th>
                        <th>KDV (%)</th>
                        <th>KDV Tutarı</th>
                        <th>KDV Dahil Toplam</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Items != null && Model.Items.Any())
                    {
                        decimal toplamAra = 0, toplamKdv = 0, toplamGenel = 0;

                        foreach (var item in Model.Items)
                        {
                            var araToplam = item.Quantity * item.UnitPrice;
                            var kdvTutar = araToplam * (item.KdvRate / 100);
                            var toplam = araToplam + kdvTutar;

                            toplamAra += araToplam;
                            toplamKdv += kdvTutar;
                            toplamGenel += toplam;

                            <tr>
                                <td>@item.StockName</td>
                                <td>@item.DepotName</td>
                                <td>@item.Quantity</td>
                                <td>@item.UnitPrice.ToString("N2") ₺</td>
                                <td>@araToplam.ToString("N2") ₺</td>
                                <td>@item.KdvRate %</td>
                                <td>@kdvTutar.ToString("N2") ₺</td>
                                <td>@toplam.ToString("N2") ₺</td>
                            </tr>
                        }

                        <tr class="table-secondary fw-bold">
                            <td colspan="4" class="text-end">TOPLAM:</td>
                            <td>@toplamAra.ToString("N2") ₺</td>
                            <td></td>
                            <td>@toplamKdv.ToString("N2") ₺</td>
                            <td>@toplamGenel.ToString("N2") ₺</td>
                        </tr>
                    }
                    else
                    {
                        <tr>
                            <td colspan="8" class="text-muted text-center">Henüz fatura kalemi eklenmemiş.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
